# Apollo AI Backend - Render.com Deployment Guide

This guide will help you deploy your Apollo AI FastAPI backend to Render.com.

## Prerequisites

1. **GitHub Repository**: Push your cleaned codebase to a GitHub repository
2. **Render Account**: Sign up at [render.com](https://render.com)

## Step 1: Prepare Your Repository

Your codebase has been cleaned and prepared for deployment. Make sure to:

1. Commit all changes to your GitHub repository
2. Push to the main branch

## Step 2: Deploy Database

1. **Go to Render Dashboard** → Create → PostgreSQL
2. **Configuration**:
   - Name: `apollo-ai-db`
   - Database Name: `apollo_ai` 
   - User: `apollo_user`
   - Region: `Oregon (US West)`
   - Plan: `Starter ($7/month)`

3. **Save the Database URL** for the next step

## Step 3: Deploy Web Service

1. **Go to Render Dashboard** → Create → Web Service
2. **Connect Repository**: Link your GitHub repository
3. **Configuration**:

### Basic Settings
- **Name**: `apollo-ai-backend`
- **Region**: `Oregon (US West)`
- **Branch**: `main`
- **Runtime**: `Python 3`
- **Build Command**: `pip install -r requirements.txt`
- **Start Command**: `gunicorn app.main:app --workers 4 --worker-class uvicorn.workers.UvicornWorker --bind 0.0.0.0:$PORT`

### Environment Variables
Add these environment variables in the Render dashboard:

#### Required Variables
```
ENVIRONMENT=production
DEBUG=false
DATABASE_URL=[Your PostgreSQL connection string from Step 2]
SECRET_KEY=[Auto-generated by Render or set your own]
```

#### Optional Variables (for AI features)
```
GROQ_API_KEY=your-groq-api-key
OPENAI_API_KEY=your-openai-api-key
ANTHROPIC_API_KEY=your-anthropic-api-key
HUGGINGFACE_API_KEY=your-huggingface-api-key
```

#### CORS Configuration
```
CORS_ORIGINS=https://your-frontend-domain.com,http://localhost:3000
```

### Advanced Settings
- **Auto-Deploy**: `Yes`
- **Health Check Path**: `/api/v1/health`

## Step 4: Configure Frontend Connection

Update your frontend to connect to your Render backend URL:
```
https://your-backend-name.onrender.com
```

## Step 5: Security Hardening

After deployment, update these settings in your code:

1. **Update CORS Origins** in `app/config/settings.py`:
```python
CORS_ORIGINS: List[str] = [
    "https://your-actual-frontend-domain.com",
    # Remove localhost entries in production
]
```

2. **Update Trusted Hosts** in `app/main.py`:
```python
app.add_middleware(
    TrustedHostMiddleware,
    allowed_hosts=["your-backend-name.onrender.com"]
)
```

## Step 6: Verify Deployment

1. **Check Health Endpoint**: `https://your-backend-name.onrender.com/api/v1/health`
2. **Check API Documentation**: `https://your-backend-name.onrender.com/docs`
3. **Monitor Logs** in Render dashboard

## Important Notes

### File Storage
- Render's ephemeral filesystem means uploaded files are temporary
- Consider using cloud storage (AWS S3, Google Cloud Storage) for persistent file storage
- Current implementation stores files in `/uploads` which will be reset on each deployment

### Database
- The PostgreSQL database is persistent and separate from the web service
- Database migrations will run automatically on startup
- Backup your database regularly

### Scaling
- Starter plan: 512MB RAM, 0.1 CPU
- Upgrade to Standard ($25/month) for: 2GB RAM, 1 CPU
- Consider upgrading for production workloads

### Monitoring
- Check Render dashboard for logs and metrics
- Set up alerts for service health
- Monitor database performance

## Troubleshooting

### Common Issues

1. **Build Fails**: Check `requirements.txt` for incompatible versions
2. **Database Connection**: Verify `DATABASE_URL` is correctly set
3. **CORS Errors**: Update `CORS_ORIGINS` with your frontend domain
4. **Health Check Fails**: Ensure `/api/v1/health` endpoint is accessible

### Debug Commands
```bash
# Check logs in Render dashboard
# Or connect via SSH (if available on your plan)

# Test database connection
python -c "from app.database.database import check_database_connection; print(check_database_connection())"

# Test API endpoint
curl https://your-backend-name.onrender.com/api/v1/health
```

## Cost Optimization

### Free Tier Limitations
- Web service spins down after 15 minutes of inactivity
- First request after inactivity takes ~30 seconds (cold start)
- 750 hours/month free compute time

### Paid Tier Benefits ($7-25/month)
- No spin down
- Always-on service
- Better performance
- SSL certificates included

## Support

- **Render Documentation**: [docs.render.com](https://docs.render.com)
- **FastAPI Documentation**: [fastapi.tiangolo.com](https://fastapi.tiangolo.com)
- **Apollo AI Issues**: Check your repository issues

---

Your Apollo AI backend is now ready for production deployment on Render.com!
